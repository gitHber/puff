/*!
 * jquery.gsearch.js 0.9.0
 * https://github.com/itobee/ghost-search
 *
 * Licensed under the MIT license.
 * https://github.com/itobee/gsearch/blob/gh-pages/LICENSE
 *
 * Copyright (c) 2016, Tobee
 * http://tobee.me
 */
!function(e){"use strict";e.fn.extend({gsearch:function(t){var r={show:10,rss:"/rss",excerpt:120,trigger:"keyup"},n=e.extend(!0,{},r,t,this.data()),a=this,s=function(){a.allPosts=[],a.fiterPosts=[],a.tmpl=e("template",a).html(),i.data(function(){e("template",a).replaceWith(c())})},i={data:function(t){e.ajax({url:n.rss,success:function(r,n){var s=e(r),c=[];"success"===n?(e.each(e("item",s),function(t){var r=e(this),n={title:e("title",r).text(),link:e("link",r).text(),content:e("encoded",r).text().replace(/<[^>]*>|[ ]|[\r\n]/gi,""),excerpt:e("description",r).text().replace(/<[^>]*>|[ ]|[\r\n]/g,""),author:e("creator",r).text(),category:e("category",r).text(),date:new Date(e("pubDate",r).text()).toLocaleDateString()};c.push(n)}),a.allPosts=c,t()):i.errors("粗错啦~~，错误类型："+n)},error:function(){i.errors("加载文章出错，请重试! ~_~")}})},filter:function(t,r){a.fiterPosts=[],e.grep(a.allPosts,function(r){var s=!0;e.each(r,function(){if(s&&null!==this.match(t))return r.excerpt=r.excerpt.slice(0,n.excerpt),a.fiterPosts.push(r),s=!1,!1})}),r()},result:function(t,r){var s=a.fiterPosts,i="";if(s.length>0){var c=s.slice((r-1)*n.show,r*n.show),o=this.tmpl("result");e.each(c,function(r,n){var a=o;e.each(n,function(e,r){if("link"!==e){var n=new RegExp(t,"g");r=r.replace(n,"<em>"+t+"</em>")}a=a.replace("{"+e+"}",r)}),i+=a})}else i=this.infos("没有找到相关文章...");return i},query:function(e){var t=a.fiterPosts,r=this.tmpl("query"),n=r.replace("{keyword}",e).replace("{amount}",t.length);return n},pages:function(e){var t=a.fiterPosts,r=Math.ceil(t.length/n.show),s=1,i=5,c="";e>2&&e<=r-2?(s=e-2,i=e+2):e>r-2&&(s=r-4,i=r);for(var o=s;o<=i&&o<=r;o++){var l=this.tmpl("pages");o>0&&(e!==o&&(l=l.replace(" active","")),c+=l.replace(/\{page}/g,o))}return c},tmpl:function(e){var t=a.tmpl,r=new RegExp("{"+e+"}([\\s\\S]*?){\\/"+e+"}","g");return t=String(t.match(r)).replace("{"+e+"}","").replace("{/"+e+"}","")},infos:function(e){return this.tmpl("infos").replace("{info}",e)},errors:function(t){var r=i.tmpl("body").replace(new RegExp("{result}([\\s\\S]*?){\\/infos}"),i.infos(t));e("template",a).replaceWith(r)}},c=function(e,t){var r=i.tmpl("body"),s="";return e?i.filter(e,function(){var c=i.tmpl("footer"),o=a.fiterPosts,l=t>1&&o.length>0?i.tmpl("prev").replace("{page}",t-1):"",p=t<o.length/n.show?i.tmpl("next").replace("{page}",t+1):"";r=r.replace(new RegExp("{result}([\\s\\S]*?){\\/infos}"),i.result(e,t)),c=c.replace(new RegExp("{query}([\\s\\S]*?){\\/query}"),i.query(e)).replace(new RegExp("{pages}([\\s\\S]*?){\\/pages}"),i.pages(t)).replace(new RegExp("{prev}([\\s\\S]*?){\\/prev}"),l).replace(new RegExp("{next}([\\s\\S]*?){\\/next}"),p),s=r+c}):s=r.replace(new RegExp("{result}([\\s\\S]*?){\\/infos}"),i.infos("啦啦啦，啦啦啦，我是卖报的小行家~")),s};return s(),e.each(this,function(){var t=e('[data-content="keywords"]',this),r=e('[data-content="clear"]',this),a=e('[data-content="content"]',this);t.on({keyup:function(t){var s=e(this).val(),i=t.keyCode?t.keyCode:t.which;("keyup"===n.trigger||"enter"===n.trigger&&13===i)&&(""!==s?(r.fadeIn(),e.trim(s)&&a.html(c(s,1))):(r.fadeOut(),a.html(c())))},focus:function(){e(this).parent().addClass("focus")},blur:function(){e(this).parent().removeClass("focus")}}),r.on("click",function(){t.val(""),e(this).fadeOut(),a.html(c())}),a.on("click","[data-page]",function(){var r=t.val(),n=e(this).data("page");a.html(c(r,n))})}),this}})}(jQuery);